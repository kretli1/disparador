<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instalador - Disparador PRO V2</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
        rel="stylesheet">

    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #3679b5 0%, #832ddb 100%);
            --bg-body: #1a1a1a;
            --bg-card: #2d2d30;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --border-color: #444444;
            --success-color: #00D95F;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        body {
            background: var(--bg-body);
            color: var(--text-primary);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .installer-container {
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(54, 121, 181, 0.1) 0%, rgba(131, 45, 219, 0.1) 100%);
            padding: 2rem 0;
        }

        .installer-card {
            background: var(--bg-card);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            overflow: hidden;
            max-width: 900px;
            margin: 0 auto;
        }

        .installer-header {
            background: var(--bg-primary);
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .installer-header::before {
            content: 'üöÄ';
            font-size: 60px;
            display: block;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        .installer-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .installer-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            padding: 0 2rem;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
            padding: 1rem;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 45px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: var(--border-color);
            z-index: 1;
        }

        .step.active:not(:last-child)::after {
            background: var(--success-color);
        }

        .step-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--border-color);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.active .step-circle {
            background: var(--success-color);
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-circle {
            background: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .installer-content {
            padding: 2rem;
        }

        .step-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-control,
        .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 10px;
            padding: 12px 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus,
        .form-select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--success-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 217, 95, 0.25);
            color: var(--text-primary);
        }

        .form-control::placeholder {
            color: var(--text-secondary);
        }

        /* File Upload Styling */
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.02);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .file-upload-area:hover {
            border-color: var(--success-color);
            background: rgba(0, 217, 95, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--success-color);
            background: rgba(0, 217, 95, 0.1);
            transform: scale(1.02);
        }

        .file-upload-area.has-file {
            border-color: var(--success-color);
            background: rgba(0, 217, 95, 0.1);
        }

        .file-upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload-content {
            pointer-events: none;
        }

        .file-upload-icon {
            font-size: 2.5rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover .file-upload-icon,
        .file-upload-area.has-file .file-upload-icon {
            color: var(--success-color);
            transform: scale(1.1);
        }

        .file-upload-text {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .file-upload-subtext {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .file-upload-success {
            color: var(--success-color);
        }

        .file-info {
            background: rgba(0, 217, 95, 0.1);
            border: 1px solid var(--success-color);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.5rem;
            display: none;
        }

        .file-info.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn-installer {
            background: var(--success-color);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 217, 95, 0.3);
        }

        .btn-installer:hover {
            background: #00c054;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 217, 95, 0.4);
            color: white;
        }

        .btn-installer:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .alert-custom {
            border: none;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            border-left: 4px solid;
        }

        .alert-info-custom {
            background: rgba(23, 162, 184, 0.1);
            border-left-color: #17a2b8;
            color: #17a2b8;
        }

        .alert-success-custom {
            background: rgba(40, 167, 69, 0.1);
            border-left-color: #28a745;
            color: #28a745;
        }

        .alert-warning-custom {
            background: rgba(255, 193, 7, 0.1);
            border-left-color: #ffc107;
            color: #ffc107;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .status-error {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .status-testing {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .file-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .file-status.success {
            border-left-color: var(--success-color);
        }

        .file-status.error {
            border-left-color: var(--danger-color);
        }

        .download-section {
            background: rgba(0, 217, 95, 0.1);
            border: 1px solid var(--success-color);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .installation-success {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            font-size: 80px;
            color: var(--success-color);
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        @media (max-width: 768px) {
            .installer-container {
                padding: 1rem;
            }

            .installer-content {
                padding: 1.5rem;
            }

            .step-indicator {
                padding: 0 1rem;
            }

            .step {
                padding: 0.5rem;
            }

            .step-circle {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }

        .video-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            /* 16:9 aspect ratio */
            height: 0;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .download-workflow-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .download-workflow-btn:hover {
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            color: white;
        }

        @media (max-width: 768px) {
            .video-section {
                padding: 1rem;
            }

            .download-workflow-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="installer-container">
        <div class="container">
            <div class="installer-card">
                <!-- Header -->
                <div class="installer-header">
                    <h1 class="installer-title">Disparador PRO V2</h1>
                    <p class="installer-subtitle">Configura√ß√£o Inteligente de Webhooks</p>
                </div>

                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active" id="step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Configura√ß√£o</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Teste</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Download</div>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-circle">‚úì</div>
                        <div class="step-label">Conclu√≠do</div>
                    </div>
                </div>

                <!-- Content -->
                <div class="installer-content">
                    <!-- Step 1: Configuration -->
                    <!-- <div class="step-content active" id="content1">
                        <h3 class="mb-4"><i class="bi bi-gear me-2"></i>Configura√ß√£o dos Webhooks</h3>

                        <div class="alert alert-info-custom mb-4">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Configure os 3 endpoints essenciais para o funcionamento do sistema.</strong><br>
                            Os webhooks ser√£o testados e os arquivos gerados automaticamente.
                        </div>

                        <form id="webhookForm">
                            <div class="row">
                                <div class="col-12 mb-4">
                                    <label for="webhookUrl" class="form-label">
                                        <i class="bi bi-send me-1"></i>
                                        <strong>Webhook Principal (Disparo de Mensagens)</strong>
                                    </label>
                                    <input type="url" class="form-control" id="webhookUrl"
                                        placeholder="https://seu-n8n.com/webhook/disparador" required>
                                    <div class="form-text text-white">URL respons√°vel pelo envio das mensagens WhatsApp
                                    </div>
                                </div>

                                <div class="col-12 mb-4">
                                    <label for="webhookConexao" class="form-label">
                                        <i class="bi bi-wifi me-1"></i>
                                        <strong>Webhook de Conex√£o (Verificar Status)</strong>
                                    </label>
                                    <input type="url" class="form-control" id="webhookConexao"
                                        placeholder="https://seu-n8n.com/webhook/verificar-conexao" required>
                                    <div class="form-text text-white">URL para verificar status da conex√£o WhatsApp
                                    </div>
                                </div>

                                <div class="col-12 mb-4">
                                    <label for="webhookEmail" class="form-label">
                                        <i class="bi bi-envelope me-1"></i>
                                        <strong>Webhook de Email (Envio de Relat√≥rios)</strong>
                                    </label>
                                    <input type="url" class="form-control" id="webhookEmail"
                                        placeholder="https://seu-n8n.com/webhook/enviar-email" required>
                                    <div class="form-text text-white">URL para envio de relat√≥rios por email</div>
                                </div>
                            </div>

                            <div class="alert alert-warning-custom">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <strong>Importante:</strong> Certifique-se de que as URLs est√£o corretas.
                                O sistema testar√° a conectividade antes de gerar os arquivos.
                            </div>

                            <div class="d-flex justify-content-end gap-3">
                                <button type="button" class="btn btn-secondary" onclick="loadDefaults()">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Exemplo Link
                                </button>
                                <button type="button" class="btn btn-installer" onclick="nextStep()">
                                    <i class="bi bi-arrow-right me-2"></i>Testar Webhooks
                                </button>
                            </div>
                        </form>
                    </div> -->


                    <div class="step-content active" id="content1">
                        <h3 class="mb-4"><i class="bi bi-gear me-2"></i>Configura√ß√£o dos Webhooks</h3>

                        <!-- Se√ß√£o do V√≠deo Tutorial -->
                        <div class="video-section">
                            <h5 class="mb-3">
                                <i class="bi bi-play-circle me-2"></i>
                                <strong>Tutorial: Como Configurar o N8N</strong>
                            </h5>

                            <div class="video-container">
                                <iframe src="https://www.youtube.com/embed/hjioepPW9BY"
                                    title="Tutorial Disparador PRO - Configura√ß√£o N8N" allowfullscreen>
                                </iframe>
                            </div>

                            <div
                                class="d-flex flex-column flex-sm-row align-items-center justify-content-between gap-3">
                                <div>
                                    <h6 class="mb-1">Workflow N8N Pronto</h6>
                                    <small class="text-white">Baixe o arquivo de workflow para importar no seu
                                        N8N</small>
                                </div>
                                <button type="button" class="download-workflow-btn" onclick="downloadWorkflow()">
                                    <i class="bi bi-download"></i>
                                    Baixar Workflow
                                </button>
                            </div>
                        </div>

                        <div class="alert alert-info-custom mb-4">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Configure os 3 endpoints essenciais para o funcionamento do sistema.</strong><br>
                            Ap√≥s assistir o v√≠deo e importar o workflow, configure as URLs dos webhooks gerados.
                        </div>

                        <form id="webhookForm">
                            <div class="row">
                                <div class="col-12 mb-4">
                                    <label for="webhookUrl" class="form-label">
                                        <i class="bi bi-send me-1"></i>
                                        <strong>Webhook Principal (Disparo de Mensagens)</strong>
                                    </label>
                                    <input type="url" class="form-control" id="webhookUrl"
                                        placeholder="https://seu-n8n.com/webhook/disparador" required>
                                    <div class="form-text text-white">URL respons√°vel pelo envio das mensagens WhatsApp
                                    </div>
                                </div>

                                <div class="col-12 mb-4">
                                    <label for="webhookConexao" class="form-label">
                                        <i class="bi bi-wifi me-1"></i>
                                        <strong>Webhook de Conex√£o (Verificar Status)</strong>
                                    </label>
                                    <input type="url" class="form-control" id="webhookConexao"
                                        placeholder="https://seu-n8n.com/webhook/verificar-conexao" required>
                                    <div class="form-text text-white">URL para verificar status da conex√£o WhatsApp
                                    </div>
                                </div>

                                <div class="col-12 mb-4">
                                    <label for="webhookEmail" class="form-label">
                                        <i class="bi bi-envelope me-1"></i>
                                        <strong>Webhook de Email (Envio de Relat√≥rios)</strong>
                                    </label>
                                    <input type="url" class="form-control" id="webhookEmail"
                                        placeholder="https://seu-n8n.com/webhook/enviar-email" required>
                                    <div class="form-text text-white">URL para envio de relat√≥rios por email</div>
                                </div>
                            </div>

                            <div class="alert alert-warning-custom">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <strong>Importante:</strong> Certifique-se de que as URLs est√£o corretas.
                                O sistema testar√° a conectividade antes de gerar os arquivos.
                            </div>

                            <div class="d-flex justify-content-end gap-3">
                                <button type="button" class="btn btn-secondary" onclick="loadDefaults()">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Exemplo Link
                                </button>
                                <button type="button" class="btn btn-installer" onclick="nextStep()">
                                    <i class="bi bi-arrow-right me-2"></i>Testar Webhooks
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Step 2: Testing -->
                    <div class="step-content" id="content2">
                        <h3 class="mb-4"><i class="bi bi-shield-check me-2"></i>Teste dos Webhooks</h3>

                        <div class="alert alert-info-custom mb-4">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Testando conectividade com os webhooks N8N...</strong><br>
                            Aguarde enquanto verificamos se as URLs est√£o acess√≠veis.
                        </div>

                        <div id="validationResults">
                            <div class="file-status" id="webhook1Status">
                                <div>
                                    <i class="bi bi-send me-2"></i>
                                    <strong>Webhook Principal</strong>
                                    <div class="small text-muted" id="webhook1Url"></div>
                                </div>
                                <div class="status-indicator status-testing" id="webhook1Result">
                                    <i class="bi bi-hourglass-split"></i>Aguardando...
                                </div>
                            </div>

                            <div class="file-status" id="webhook2Status">
                                <div>
                                    <i class="bi bi-wifi me-2"></i>
                                    <strong>Webhook de Conex√£o</strong>
                                    <div class="small text-muted" id="webhook2Url"></div>
                                </div>
                                <div class="status-indicator status-testing" id="webhook2Result">
                                    <i class="bi bi-hourglass-split"></i>Aguardando...
                                </div>
                            </div>

                            <div class="file-status" id="webhook3Status">
                                <div>
                                    <i class="bi bi-envelope me-2"></i>
                                    <strong>Webhook de Email</strong>
                                    <div class="small text-muted" id="webhook3Url"></div>
                                </div>
                                <div class="status-indicator status-testing" id="webhook3Result">
                                    <i class="bi bi-hourglass-split"></i>Aguardando...
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-success-custom mt-4" id="testSummary" style="display: none;">
                            <h6><i class="bi bi-clipboard-check me-2"></i>Resultado dos Testes</h6>
                            <p id="testSummaryText"></p>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                <i class="bi bi-arrow-left me-2"></i>Voltar
                            </button>
                            <div>
                                <button type="button" class="btn btn-warning me-2" onclick="retestWebhooks()">
                                    <i class="bi bi-arrow-repeat me-2"></i>Testar Novamente
                                </button>
                                <button type="button" class="btn btn-installer" id="proceedDownloadBtn"
                                    onclick="nextStep()" disabled>
                                    <i class="bi bi-download me-2"></i>Gerar Arquivos
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Download Files -->
                    <div class="step-content" id="content3">
                        <h3 class="mb-4"><i class="bi bi-upload me-2"></i>Upload e Configura√ß√£o dos Arquivos</h3>

                        <div class="alert alert-info-custom mb-4">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Selecione os arquivos originais para gerar vers√µes configuradas:</strong><br>
                            Fa√ßa upload dos arquivos mainOriginal.js e relatorioOriginal.js originais para criar vers√µes
                            com suas configura√ß√µes.
                        </div>

                        <div class="download-section" id="uploadSection">
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6><i class="bi bi-file-earmark-code me-2"></i>main.js Original</h6>

                                            <div class="file-upload-area" id="mainJsUpload">
                                                <input type="file" id="mainJsFile" accept=".js">
                                                <div class="file-upload-content">
                                                    <div class="file-upload-icon">
                                                        <i class="bi bi-cloud-upload"></i>
                                                    </div>
                                                    <div class="file-upload-text">Clique ou arraste o arquivo</div>
                                                    <div class="file-upload-subtext">main.js original</div>
                                                </div>
                                            </div>

                                            <div class="file-info" id="mainJsInfo">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-file-check text-success me-2"></i>
                                                    <div>
                                                        <strong id="mainJsFileName">arquivo.js</strong>
                                                        <div class="small text-muted" id="mainJsFileSize">0 KB</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mt-3 d-flex gap-2">
                                                <button class="btn btn-outline-primary btn-sm" onclick="processMainJs()"
                                                    disabled id="processMainBtn">
                                                    <i class="bi bi-gear me-2"></i>Configurar
                                                </button>
                                                <button class="btn btn-success btn-sm" onclick="downloadMainJs()"
                                                    disabled id="downloadMainBtn">
                                                    <i class="bi bi-download me-2"></i>Download
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6><i class="bi bi-file-earmark-code me-2"></i>relatorio.js Original</h6>

                                            <div class="file-upload-area" id="relatorioJsUpload">
                                                <input type="file" id="relatorioJsFile" accept=".js">
                                                <div class="file-upload-content">
                                                    <div class="file-upload-icon">
                                                        <i class="bi bi-cloud-upload"></i>
                                                    </div>
                                                    <div class="file-upload-text">Clique ou arraste o arquivo</div>
                                                    <div class="file-upload-subtext">relatorio.js original</div>
                                                </div>
                                            </div>

                                            <div class="file-info" id="relatorioJsInfo">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-file-check text-success me-2"></i>
                                                    <div>
                                                        <strong id="relatorioJsFileName">arquivo.js</strong>
                                                        <div class="small text-muted" id="relatorioJsFileSize">0 KB
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mt-3 d-flex gap-2">
                                                <button class="btn btn-outline-primary btn-sm"
                                                    onclick="processRelatorioJs()" disabled id="processRelatorioBtn">
                                                    <i class="bi bi-gear me-2"></i>Configurar
                                                </button>
                                                <button class="btn btn-success btn-sm" onclick="downloadRelatorioJs()"
                                                    disabled id="downloadRelatorioBtn">
                                                    <i class="bi bi-download me-2"></i>Download
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning-custom mb-4">
                            <h6><i class="bi bi-exclamation-triangle me-2"></i>Instru√ß√µes de Instala√ß√£o</h6>
                            <ol class="mb-0">
                                <li>Fa√ßa upload dos arquivos originais usando as √°reas acima</li>
                                <li>Clique em "Configurar" para aplicar os webhooks</li>
                                <li>Baixe os arquivos configurados</li>
                                <li>Substitua os arquivos originais pelos configurados</li>
                                <li>Abra o <strong>index.html</strong> para usar o sistema</li>
                            </ol>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                <i class="bi bi-arrow-left me-2"></i>Voltar
                            </button>
                            <button type="button" class="btn btn-installer" onclick="nextStep()">
                                <i class="bi bi-check me-2"></i>Finalizar
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Completed -->
                    <div class="step-content" id="content4">
                        <div class="installation-success">
                            <div class="success-icon">
                                <i class="bi bi-check-circle-fill"></i>
                            </div>
                            <h2 class="mb-3">Configura√ß√£o Conclu√≠da!</h2>
                            <p class="lead mb-4">
                                O Disparador PRO V2 foi configurado com sucesso.<br>
                                Os arquivos foram gerados com seus webhooks personalizados.
                            </p>

                            <div class="alert alert-success-custom mb-4">
                                <i class="bi bi-check-circle me-2"></i>
                                <strong>Configura√ß√µes aplicadas:</strong><br>
                                ‚Ä¢ main.js configurado com webhooks de disparo e conex√£o<br>
                                ‚Ä¢ relatorio.js configurado com webhook de email<br>
                                ‚Ä¢ Arquivos prontos para substituir os originais
                            </div>

                            <div class="row text-center mb-4">
                                <div class="col-md-4">
                                    <i class="bi bi-send-check fs-1 text-success mb-2"></i>
                                    <h6>Disparo</h6>
                                    <small class="text-white">Pronto para enviar mensagens</small>
                                </div>
                                <div class="col-md-4">
                                    <i class="bi bi-wifi fs-1 text-success mb-2"></i>
                                    <h6>Conex√£o</h6>
                                    <small class="text-white">Verifica√ß√£o WhatsApp ativa</small>
                                </div>
                                <div class="col-md-4">
                                    <i class="bi bi-envelope-check fs-1 text-success mb-2"></i>
                                    <h6>Relat√≥rios</h6>
                                    <small class="text-white">Email funcionando</small>
                                </div>
                            </div>

                            <div class="d-flex justify-content-center gap-3">
                                <button type="button" class="btn btn-installer btn-lg" onclick="openDisparador()">
                                    <i class="bi bi-rocket-takeoff me-2"></i>Abrir Disparador PRO
                                </button>
                            </div>

                            <div class="mt-4">
                                <small class="text-white">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Lembre-se: Substitua os arquivos originais pelos baixados para ativar as
                                    configura√ß√µes.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentStep = 1;
        let webhookConfig = {};
        let validationResults = {};

        // Navigation functions
        function nextStep() {
            if (currentStep === 1) {
                if (validateForm()) {
                    currentStep = 2;
                    updateSteps();
                    startValidation();
                }
            } else if (currentStep === 2) {
                if (allValidationsPassed()) {
                    currentStep = 3;
                    updateSteps();
                    initializeFileUploads();
                }
            } else if (currentStep === 3) {
                currentStep = 4;
                updateSteps();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateSteps();
            }
        }

        function updateSteps() {
            // Update step indicators
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                const content = document.getElementById(`content${i}`);

                if (i < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (i === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }

                content.classList.toggle('active', i === currentStep);
            }
        }

        function validateForm() {
            const form = document.getElementById('webhookForm');
            if (form.checkValidity()) {
                webhookConfig = {
                    webhookUrl: document.getElementById('webhookUrl').value.trim(),
                    webhookConexao: document.getElementById('webhookConexao').value.trim(),
                    webhookEmail: document.getElementById('webhookEmail').value.trim()
                };
                return true;
            } else {
                form.reportValidity();
                return false;
            }
        }

        function loadDefaults() {
            document.getElementById('webhookUrl').value = 'https://webhook.seudominio.com.br/webhook/disparadorProV2';
            document.getElementById('webhookConexao').value = 'https://webhook.seudominio.com.br/webhook/verificarConexao';
            document.getElementById('webhookEmail').value = 'https://webhook.seudominio.com.br/webhook/enviarEmail';
        }

        // Reset validation status
        function resetValidationStatus() {
            const webhookIds = ['webhook1', 'webhook2', 'webhook3'];

            webhookIds.forEach(id => {
                const statusElement = document.getElementById(`${id}Status`);
                const resultElement = document.getElementById(`${id}Result`);

                // Reset classes
                statusElement.className = 'file-status';
                resultElement.className = 'status-indicator status-testing';
                resultElement.innerHTML = '<i class="bi bi-hourglass-split"></i>Aguardando...';
            });

            // Hide summary
            document.getElementById('testSummary').style.display = 'none';
            document.getElementById('proceedDownloadBtn').disabled = true;

            // Reset validation results
            validationResults = {};
        }

        async function startValidation() {
            resetValidationStatus();

            const webhooks = [
                { id: 'webhook1', url: webhookConfig.webhookUrl, name: 'Webhook Principal', type: 'disparo' },
                { id: 'webhook2', url: webhookConfig.webhookConexao, name: 'Webhook de Conex√£o', type: 'conexao' },
                { id: 'webhook3', url: webhookConfig.webhookEmail, name: 'Webhook de Email', type: 'email' }
            ];

            // Update URLs in display
            document.getElementById('webhook1Url').textContent = webhookConfig.webhookUrl;
            document.getElementById('webhook2Url').textContent = webhookConfig.webhookConexao;
            document.getElementById('webhook3Url').textContent = webhookConfig.webhookEmail;

            let passedTests = 0;

            for (const webhook of webhooks) {
                try {
                    console.log(`Testing ${webhook.name}: ${webhook.url}`);

                    // Update status to testing
                    const resultElement = document.getElementById(`${webhook.id}Result`);
                    resultElement.className = 'status-indicator status-testing';
                    resultElement.innerHTML = '<i class="bi bi-hourglass-split"></i>Testando...';

                    const result = await testRealWebhook(webhook.url, webhook.type);

                    if (result.success) {
                        updateValidationStatus(webhook.id, true, result.message);
                        validationResults[webhook.id] = true;
                        passedTests++;
                    } else {
                        updateValidationStatus(webhook.id, false, result.message);
                        validationResults[webhook.id] = false;
                    }
                } catch (error) {
                    updateValidationStatus(webhook.id, false, 'Erro de conex√£o: ' + error.message);
                    validationResults[webhook.id] = false;
                }
            }

            // Show summary
            showValidationSummary(passedTests, webhooks.length);

            // Enable proceed button if all tests passed
            if (passedTests === webhooks.length) {
                document.getElementById('proceedDownloadBtn').disabled = false;
            }
        }

        async function testRealWebhook(url, webhookType) {
            try {
                console.log(`üîç Testando webhook real: ${url}`);

                let testPayload = {};

                // Criar payload espec√≠fico para cada tipo de webhook
                switch (webhookType) {
                    case 'disparo':
                        testPayload = {
                            test: true,
                            instanceName: 'TEST_INSTALLER',
                            instanceAPIKEY: 'TEST_KEY',
                            contact: { name: 'Teste', phone: '5511999999999' },
                            message: 'Teste de conectividade do instalador'
                        };
                        break;

                    case 'conexao':
                        testPayload = {
                            test: true,
                            instanceName: 'TEST_INSTALLER',
                            instanceAPIKEY: 'TEST_KEY'
                        };
                        break;

                    case 'email':
                        testPayload = {
                            test: true,
                            to: 'test@test.com',
                            subject: 'Teste de conectividade',
                            message: 'Teste do instalador'
                        };
                        break;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 segundos timeout

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'Disparador-PRO-Installer/2.3'
                    },
                    body: JSON.stringify(testPayload),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                console.log(`üì° Resposta do webhook:`, {
                    status: response.status,
                    statusText: response.statusText
                });

                // N8N geralmente retorna 200 mesmo para testes
                // Considerar sucesso se status 200-499 (webhook existe e responde)
                if (response.status >= 200 && response.status < 500) {
                    return {
                        success: true,
                        status: response.status,
                        message: response.status < 300 ? 'Webhook ativo e funcionando' : 'Webhook ativo (resposta de teste esperada)',
                        responseTime: Date.now()
                    };
                } else {
                    return {
                        success: false,
                        status: response.status,
                        message: `Webhook retornou status ${response.status}`
                    };
                }

            } catch (error) {
                console.error(`‚ùå Erro ao testar webhook:`, error);

                if (error.name === 'AbortError') {
                    return {
                        success: false,
                        message: 'Timeout - webhook muito lento para responder (>10s)',
                        error: 'TIMEOUT'
                    };
                } else if (error.message.includes('Failed to fetch')) {
                    return {
                        success: false,
                        message: 'Webhook inacess√≠vel - verifique URL e CORS',
                        error: 'NETWORK_ERROR'
                    };
                } else {
                    return {
                        success: false,
                        message: `Erro: ${error.message}`,
                        error: error.name
                    };
                }
            }
        }

        function updateValidationStatus(webhookId, success, message) {
            const resultElement = document.getElementById(`${webhookId}Result`);
            const statusElement = document.getElementById(`${webhookId}Status`);

            if (success) {
                resultElement.className = 'status-indicator status-success';
                resultElement.innerHTML = '<i class="bi bi-check-circle"></i>Conectado';
                statusElement.classList.add('success');
            } else {
                resultElement.className = 'status-indicator status-error';
                resultElement.innerHTML = '<i class="bi bi-x-circle"></i>Erro';
                statusElement.classList.add('error');
            }
        }

        function showValidationSummary(passed, total) {
            const summary = document.getElementById('testSummary');
            const summaryText = document.getElementById('testSummaryText');

            if (passed === total) {
                summaryText.innerHTML = `<strong>‚úÖ Todos os webhooks est√£o funcionando!</strong><br>Voc√™ pode prosseguir para gerar os arquivos configurados.`;
                summary.className = 'alert alert-success-custom mt-4';
            } else {
                summaryText.innerHTML = `<strong>‚ö†Ô∏è ${passed}/${total} webhooks funcionando.</strong><br>Verifique as URLs que falharam e teste novamente ou prossiga mesmo assim.`;
                summary.className = 'alert alert-warning-custom mt-4';

                // Permitir prosseguir mesmo com alguns erros
                document.getElementById('proceedDownloadBtn').disabled = false;
            }

            summary.style.display = 'block';
        }

        function allValidationsPassed() {
            // Permitir prosseguir mesmo se nem todos passaram
            return Object.keys(validationResults).length > 0;
        }

        function retestWebhooks() {
            console.log('üîÑ Retestando webhooks...');
            startValidation();
        }

        // Initialize file upload functionality
        function initializeFileUploads() {
            setupFileUpload('mainJs');
            setupFileUpload('relatorioJs');
        }

        function setupFileUpload(fileType) {
            const uploadArea = document.getElementById(`${fileType}Upload`);
            const fileInput = document.getElementById(`${fileType}File`);
            const fileInfo = document.getElementById(`${fileType}Info`);
            const fileName = document.getElementById(`${fileType}FileName`);
            const fileSize = document.getElementById(`${fileType}FileSize`);
            //const processBtn = document.getElementById(`process${fileType.charAt(0).toUpperCase() + fileType.slice(1)}Btn`);
            const processBtn = document.getElementById(`process${fileType === 'mainJs' ? 'Main' : 'Relatorio'}Btn`);

            // Drag and drop events
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');

                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].name.endsWith('.js')) {
                    fileInput.files = files;
                    handleFileSelect(fileType, files[0]);
                }
            });

            // File input change event
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(fileType, e.target.files[0]);
                }
            });
        }

        function handleFileSelect(fileType, file) {
            const uploadArea = document.getElementById(`${fileType}Upload`);
            const fileInfo = document.getElementById(`${fileType}Info`);
            const fileName = document.getElementById(`${fileType}FileName`);
            const fileSize = document.getElementById(`${fileType}FileSize`);
            //const processBtn = document.getElementById(`process${fileType.charAt(0).toUpperCase() + fileType.slice(1)}Btn`);
            const processBtn = document.getElementById(`process${fileType === 'mainJs' ? 'Main' : 'Relatorio'}Btn`);
            const uploadContent = uploadArea.querySelector('.file-upload-content');

            // Update visual state
            uploadArea.classList.add('has-file');
            fileInfo.classList.add('show');

            // Update file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);

            // Update upload area content
            uploadContent.innerHTML = `
                <div class="file-upload-icon file-upload-success">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <div class="file-upload-text file-upload-success">Arquivo selecionado!</div>
                <div class="file-upload-subtext">${file.name}</div>
            `;

            // Enable process button
            processBtn.disabled = false;

            console.log(`üìÅ Arquivo ${fileType} selecionado:`, file.name, formatFileSize(file.size));
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function processMainJs() {
            const fileInput = document.getElementById('mainJsFile');
            const file = fileInput.files[0];

            if (!file) return;

            try {
                const content = await file.text();
                console.log('‚úÖ main.js carregado:', content.length, 'caracteres');

                // Aplicar configura√ß√µes
                let configuredContent = content;

                const webhookUrlRegex = /webhookUrl:\s*['"`]([^'"`]+)['"`]/g;
                configuredContent = configuredContent.replace(webhookUrlRegex, `webhookUrl: '${webhookConfig.webhookUrl}'`);

                const webhookConexaoRegex = /webhookConexao:\s*['"`]([^'"`]+)['"`]/g;
                configuredContent = configuredContent.replace(webhookConexaoRegex, `webhookConexao: '${webhookConfig.webhookConexao}'`);

                // Adicionar coment√°rio
                const timestamp = new Date().toLocaleString('pt-BR');
                const configComment = `// CONFIGURADO AUTOMATICAMENTE - ${timestamp}\n// Webhooks: ${webhookConfig.webhookUrl} | ${webhookConfig.webhookConexao}\n\n`;

                window.generatedMainJs = configComment + configuredContent;

                // Habilitar download
                document.getElementById('downloadMainBtn').disabled = false;
                document.getElementById('processMainBtn').innerHTML = '<i class="bi bi-check me-2"></i>Configurado!';
                document.getElementById('processMainBtn').className = 'btn btn-success btn-sm';

                console.log('‚úÖ main.js configurado com sucesso');

            } catch (error) {
                console.error('‚ùå Erro ao processar main.js:', error);
                alert('Erro ao processar main.js: ' + error.message);
            }
        }

        async function processRelatorioJs() {
            const fileInput = document.getElementById('relatorioJsFile');
            const file = fileInput.files[0];

            if (!file) return;

            try {
                const content = await file.text();
                console.log('‚úÖ relatorio.js carregado:', content.length, 'caracteres');

                // Aplicar configura√ß√µes
                let configuredContent = content;

                const emailWebhookPatterns = [
                    {
                        regex: /fetch\(\s*['"`]https:\/\/webhook\.seudominio\.app\.br\/webhook\/enviarEmail['"`]/g,
                        replacement: `fetch('${webhookConfig.webhookEmail}'`
                    },
                    {
                        regex: /fetch\(\s*['"`]([^'"`]*webhook[^'"`]*enviarEmail[^'"`]*)['"`]/g,
                        replacement: `fetch('${webhookConfig.webhookEmail}'`
                    },
                    {
                        regex: /'https:\/\/webhook\.seudominio\.app\.br\/webhook\/enviarEmail'/g,
                        replacement: `'${webhookConfig.webhookEmail}'`
                    }
                ];

                let patternFound = false;
                emailWebhookPatterns.forEach((pattern, index) => {
                    if (pattern.regex.test(configuredContent)) {
                        configuredContent = configuredContent.replace(pattern.regex, pattern.replacement);
                        patternFound = true;
                        console.log(`‚úÖ Padr√£o ${index + 1} aplicado`);
                    }
                });

                // Adicionar coment√°rio
                const timestamp = new Date().toLocaleString('pt-BR');
                const configComment = `// CONFIGURADO AUTOMATICAMENTE - ${timestamp}\n// Webhook Email: ${webhookConfig.webhookEmail}\n// Padr√µes aplicados: ${patternFound ? 'Sim' : 'Manual necess√°rio'}\n\n`;

                window.generatedRelatorioJs = configComment + configuredContent;

                // Habilitar download
                document.getElementById('downloadRelatorioBtn').disabled = false;
                document.getElementById('processRelatorioBtn').innerHTML = '<i class="bi bi-check me-2"></i>Configurado!';
                document.getElementById('processRelatorioBtn').className = 'btn btn-success btn-sm';

                console.log('‚úÖ relatorio.js configurado com sucesso');

            } catch (error) {
                console.error('‚ùå Erro ao processar relatorio.js:', error);
                alert('Erro ao processar relatorio.js: ' + error.message);
            }
        }

        function downloadMainJs() {
            if (!window.generatedMainJs) {
                alert('Primeiro fa√ßa upload e configure o arquivo main.js');
                return;
            }

            const blob = new Blob([window.generatedMainJs], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);

            const link = document.createElement('a');
            link.href = url;
            link.download = 'main.js';
            link.style.display = 'none';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            URL.revokeObjectURL(url);

            console.log('‚úÖ main.js baixado');
        }

        function downloadRelatorioJs() {
            if (!window.generatedRelatorioJs) {
                alert('Primeiro fa√ßa upload e configure o arquivo relatorio.js');
                return;
            }

            const blob = new Blob([window.generatedRelatorioJs], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);

            const link = document.createElement('a');
            link.href = url;
            link.download = 'relatorio.js';
            link.style.display = 'none';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            URL.revokeObjectURL(url);

            console.log('‚úÖ relatorio.js baixado');
        }

        function openDisparador() {
            // Try to open index.html
            const currentURL = window.location.href;
            const baseURL = currentURL.substring(0, currentURL.lastIndexOf('/') + 1);
            const disparadorURL = baseURL + 'index.html';

            window.open(disparadorURL, '_blank');
        }

        // Auto-update webhook URLs when typing
        document.addEventListener('DOMContentLoaded', function () {
            const inputs = ['webhookUrl', 'webhookConexao', 'webhookEmail'];

            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', function () {
                        // Validate URL format
                        if (this.value && !this.value.startsWith('https://')) {
                            this.setCustomValidity('URL deve come√ßar com https://');
                        } else {
                            this.setCustomValidity('');
                        }
                    });
                }
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                // Ctrl+Enter to advance
                if (currentStep < 4) {
                    nextStep();
                }
            } else if (e.key === 'Escape') {
                // Escape to go back
                if (currentStep > 1) {
                    prevStep();
                }
            }
        });

        // Initialize
        console.log('üöÄ Disparador PRO V2 Installer carregado!');
        console.log('üìã Use Ctrl+Enter para avan√ßar, Escape para voltar');

        function downloadWorkflow() {
            try {
                // Criar o conte√∫do do workflow (voc√™ pode substituir por seu workflow real)
                const workflowContent = 
                    {
					  "name": "Workflow Disparador PRO V2.4",
					  "nodes": [
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "{\n  \"results\": \"success\"\n}",
							"options": {
							  "responseCode": 200
							}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							2860,
							680
						  ],
						  "id": "5ca15b0f-d82a-4e76-b2ea-243095c8a360",
						  "name": "Respond to Webhook"
						},
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "{\n  \"results\": \"error\"\n}",
							"options": {
							  "responseCode": 400
							}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							2860,
							880
						  ],
						  "id": "dc9aca4d-12df-400b-9c3d-49e04267bb25",
						  "name": "Respond to Webhook1"
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "b6520e7e-fc14-40bd-bfc1-ccab2bda8b8f",
								  "name": "baseUrl",
								  "value": "https://evolutionapi.typebotdescomplicado.com.br/",
								  "type": "string"
								},
								{
								  "id": "04a9c7b9-b67b-495a-b64c-f8ff2bd18b28",
								  "name": "instance",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"instanceName\"] }}",
								  "type": "string"
								},
								{
								  "id": "69b27f58-242e-486c-8421-8f20c6e7c745",
								  "name": "apikey",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"instanceAPIKEY\"] }}",
								  "type": "string"
								},
								{
								  "id": "2fbe3337-8f64-4649-866e-bfb58c21e1a2",
								  "name": "chatInput",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"message\"] }}",
								  "type": "string"
								},
								{
								  "id": "51ca3fa3-3d59-4f85-8a38-97bd33e1c199",
								  "name": "mediatype",
								  "value": "={{ $json.mediatype }}",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "id": "472ec113-5275-4a0d-935b-21356dbb2f06",
						  "name": "Configura√ß√µes Evolution",
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							720,
							1100
						  ]
						},
						{
						  "parameters": {
							"options": {
							  "systemMessage": "=Preciso que melhore o texto abaixo sem perder o sentido, manter a formata√ß√£o.\n\nObserva√ß√£o n√£o mude o sentido do texto, envie apenas o texto n√£o precisa explicar que fez melhorias.\n\n\"Mantenha a formata√ß√£o EXATAMENTE como WhatsApp: \n- Use *texto* para negrito (UM asterisco)\n- Use _texto_ para it√°lico (UM underscore)\n- N√ÉO use **texto** ou <em>texto</em> ou outras formata√ß√µes\".\n\nTexto: {{ $json.chatInput }}"
							}
						  },
						  "type": "@n8n/n8n-nodes-langchain.agent",
						  "typeVersion": 1.9,
						  "position": [
							1160,
							780
						  ],
						  "id": "412df92c-6bb6-45d9-8ff2-9bae6c33dfe3",
						  "name": "AI Agent"
						},
						{
						  "parameters": {
							"conditions": {
							  "options": {
								"caseSensitive": true,
								"leftValue": "",
								"typeValidation": "strict",
								"version": 2
							  },
							  "conditions": [
								{
								  "id": "c5bce875-d761-403f-b827-37bf6ab3d901",
								  "leftValue": "={{ $('Disparo PRO').item.json.body.media.data }}",
								  "rightValue": "",
								  "operator": {
									"type": "string",
									"operation": "exists",
									"singleValue": true
								  }
								}
							  ],
							  "combinator": "and"
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.if",
						  "typeVersion": 2.2,
						  "position": [
							1540,
							780
						  ],
						  "id": "e2e873d4-3335-4cc9-857a-8f6a19f4882b",
						  "name": "If"
						},
						{
						  "parameters": {
							"method": "POST",
							"url": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"baseUrl\"] }}message/sendText/{{ $node[\"Configura√ß√µes Evolution\"].json[\"instance\"] }}",
							"sendHeaders": true,
							"headerParameters": {
							  "parameters": [
								{
								  "name": "apikey",
								  "value": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"apikey\"] }}"
								}
							  ]
							},
							"sendBody": true,
							"bodyParameters": {
							  "parameters": [
								{
								  "name": "number",
								  "value": "={{ $('Disparo PRO').item.json.body.contact.phone }}"
								},
								{
								  "name": "text",
								  "value": "={{ $item(\"0\").$node[\"AI Agent\"].json[\"output\"] }}"
								}
							  ]
							},
							"options": {}
						  },
						  "id": "65784403-9322-40a8-a9eb-29443864b0db",
						  "name": "Envio Texto",
						  "type": "n8n-nodes-base.httpRequest",
						  "typeVersion": 4.2,
						  "position": [
							2640,
							920
						  ],
						  "onError": "continueErrorOutput"
						},
						{
						  "parameters": {
							"method": "POST",
							"url": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"baseUrl\"] }}message/sendMedia/{{ $node[\"Configura√ß√µes Evolution\"].json[\"instance\"] }}",
							"sendHeaders": true,
							"headerParameters": {
							  "parameters": [
								{
								  "name": "apikey",
								  "value": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"apikey\"] }}"
								}
							  ]
							},
							"sendBody": true,
							"bodyParameters": {
							  "parameters": [
								{
								  "name": "number",
								  "value": "={{ $('Disparo PRO').item.json.body.contact.phone }}"
								},
								{
								  "name": "mimetype",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"mimetype\"] }}"
								},
								{
								  "name": "media",
								  "value": "={{ $('Disparo PRO').item.json.body.media.data }}"
								},
								{
								  "name": "fileName",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"filename\"] }}"
								},
								{
								  "name": "caption",
								  "value": "={{ $item(\"0\").$node[\"AI Agent\"].json[\"output\"] }}"
								},
								{
								  "name": "mediatype",
								  "value": "={{ $item(\"0\").$node[\"Configura√ß√µes Evolution\"].json[\"mediatype\"] }}"
								}
							  ]
							},
							"options": {}
						  },
						  "id": "d586df8b-9498-4962-adb2-8658005966de",
						  "name": "Envio M√≠dia",
						  "type": "n8n-nodes-base.httpRequest",
						  "typeVersion": 4.2,
						  "position": [
							2640,
							620
						  ],
						  "onError": "continueErrorOutput"
						},
						{
						  "parameters": {
							"conditions": {
							  "options": {
								"caseSensitive": true,
								"leftValue": "",
								"typeValidation": "strict",
								"version": 2
							  },
							  "conditions": [
								{
								  "id": "2f8a50e7-9398-482b-9838-79e849275656",
								  "leftValue": "={{ $('Disparo PRO').item.json.body.ia }}",
								  "rightValue": "1",
								  "operator": {
									"type": "string",
									"operation": "equals",
									"name": "filter.operator.equals"
								  }
								}
							  ],
							  "combinator": "and"
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.if",
						  "typeVersion": 2.2,
						  "position": [
							940,
							1100
						  ],
						  "id": "a7afccab-51ed-4f0f-bc3a-4843bfbe2b2e",
						  "name": "If1"
						},
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "{\n  \"results\": \"success\"\n}",
							"options": {
							  "responseCode": 200
							}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							2640,
							1300
						  ],
						  "id": "09db128c-fd69-4e88-b25d-01932c2e7f32",
						  "name": "Respond to Webhook2"
						},
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "{\n  \"results\": \"error\"\n}",
							"options": {
							  "responseCode": 400
							}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							2640,
							1500
						  ],
						  "id": "47797b64-9748-48e5-88c4-bfb7532bac82",
						  "name": "Respond to Webhook3"
						},
						{
						  "parameters": {
							"conditions": {
							  "options": {
								"caseSensitive": true,
								"leftValue": "",
								"typeValidation": "strict",
								"version": 2
							  },
							  "conditions": [
								{
								  "id": "c5bce875-d761-403f-b827-37bf6ab3d901",
								  "leftValue": "={{ $('Disparo PRO').item.json.body.media.data }}",
								  "rightValue": "",
								  "operator": {
									"type": "string",
									"operation": "exists",
									"singleValue": true
								  }
								}
							  ],
							  "combinator": "and"
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.if",
						  "typeVersion": 2.2,
						  "position": [
							1240,
							1400
						  ],
						  "id": "c095e080-7972-4730-afda-72cb0cdb5801",
						  "name": "If2"
						},
						{
						  "parameters": {
							"method": "POST",
							"url": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"baseUrl\"] }}message/sendText/{{ $node[\"Configura√ß√µes Evolution\"].json[\"instance\"] }}",
							"sendHeaders": true,
							"headerParameters": {
							  "parameters": [
								{
								  "name": "apikey",
								  "value": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"apikey\"] }}"
								}
							  ]
							},
							"sendBody": true,
							"bodyParameters": {
							  "parameters": [
								{
								  "name": "number",
								  "value": "={{ $('Disparo PRO').item.json.body.contact.phone }}"
								},
								{
								  "name": "text",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"message\"] }}"
								}
							  ]
							},
							"options": {}
						  },
						  "id": "c716a844-f825-4199-9ea8-3840fa3052b7",
						  "name": "Envio Texto2",
						  "type": "n8n-nodes-base.httpRequest",
						  "typeVersion": 4.2,
						  "position": [
							2420,
							1540
						  ],
						  "onError": "continueErrorOutput"
						},
						{
						  "parameters": {
							"method": "POST",
							"url": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"baseUrl\"] }}message/sendMedia/{{ $node[\"Configura√ß√µes Evolution\"].json[\"instance\"] }}",
							"sendHeaders": true,
							"headerParameters": {
							  "parameters": [
								{
								  "name": "apikey",
								  "value": "={{ $node[\"Configura√ß√µes Evolution\"].json[\"apikey\"] }}"
								}
							  ]
							},
							"sendBody": true,
							"bodyParameters": {
							  "parameters": [
								{
								  "name": "number",
								  "value": "={{ $('Disparo PRO').item.json.body.contact.phone }}"
								},
								{
								  "name": "mimetype",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"mimetype\"] }}"
								},
								{
								  "name": "media",
								  "value": "={{ $('Disparo PRO').item.json.body.media.data }}"
								},
								{
								  "name": "fileName",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"filename\"] }}"
								},
								{
								  "name": "caption",
								  "value": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"message\"] }}"
								},
								{
								  "name": "mediatype",
								  "value": "={{ $item(\"0\").$node[\"Configura√ß√µes Evolution\"].json[\"mediatype\"] }}"
								}
							  ]
							},
							"options": {}
						  },
						  "id": "ebd135f8-eec3-4e7b-ae95-32e4127c56e1",
						  "name": "Envio M√≠dia1",
						  "type": "n8n-nodes-base.httpRequest",
						  "typeVersion": 4.2,
						  "position": [
							2420,
							1240
						  ],
						  "onError": "continueErrorOutput"
						},
						{
						  "parameters": {
							"options": {}
						  },
						  "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
						  "typeVersion": 1,
						  "position": [
							1140,
							1000
						  ],
						  "id": "27a6e4bc-5166-4e76-894c-cdd8c53979c8",
						  "name": "Groq Chat Model",
						  "credentials": {
							"groqApi": {
							  "id": "VSGiXCkK5AarddOv",
							  "name": "Groq account"
							}
						  }
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "b6520e7e-fc14-40bd-bfc1-ccab2bda8b8f",
								  "name": "baseUrl",
								  "value": "https://evolutionapi.typebotdescomplicado.com.br/",
								  "type": "string"
								},
								{
								  "id": "04a9c7b9-b67b-495a-b64c-f8ff2bd18b28",
								  "name": "instance",
								  "value": "={{ $json.body.instanceName }}",
								  "type": "string"
								},
								{
								  "id": "69b27f58-242e-486c-8421-8f20c6e7c745",
								  "name": "apikey",
								  "value": "={{ $json.body.instanceAPIKEY }}",
								  "type": "string"
								},
								{
								  "id": "2fbe3337-8f64-4649-866e-bfb58c21e1a2",
								  "name": "chatInput",
								  "value": "={{ $json.body.message }}",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "id": "f7065e29-6098-4aaa-bc25-6552b043a8d6",
						  "name": "Configura√ß√µes Evolution1",
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							1300,
							140
						  ]
						},
						{
						  "parameters": {
							"httpMethod": "POST",
							"path": "ca658654-80a0-41e5-838f-8c8fd1af661e",
							"responseMode": "responseNode",
							"options": {}
						  },
						  "type": "n8n-nodes-base.webhook",
						  "typeVersion": 2,
						  "position": [
							1080,
							140
						  ],
						  "id": "1e5b375f-596a-4e92-ae16-f7b5aed625ae",
						  "name": "Verifica Conexao",
						  "webhookId": "ca658654-80a0-41e5-838f-8c8fd1af661e"
						},
						{
						  "parameters": {
							"url": "={{ $json.baseUrl }}instance/connect/{{ $json.instance }}",
							"sendHeaders": true,
							"headerParameters": {
							  "parameters": [
								{
								  "name": "apikey",
								  "value": "={{ $json.apikey }}"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.httpRequest",
						  "typeVersion": 4.2,
						  "position": [
							1520,
							140
						  ],
						  "id": "cacabd65-ad6c-4588-a217-cca13976a2f7",
						  "name": "Verifica Instancia",
						  "onError": "continueErrorOutput"
						},
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "={\n  \"result\": \"{{ $json.base64 || $json.instance.state }}\"\n} ",
							"options": {}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							1740,
							40
						  ],
						  "id": "9923f35f-edfb-4e94-8a91-975f2570ac59",
						  "name": "Resposta Instancia"
						},
						{
						  "parameters": {
							"httpMethod": "POST",
							"path": "2fa4dafe-d9c4-4072-bb74-af75801adf3d",
							"responseMode": "responseNode",
							"options": {}
						  },
						  "type": "n8n-nodes-base.webhook",
						  "typeVersion": 2,
						  "position": [
							60,
							1100
						  ],
						  "id": "c37afefd-45f3-45f9-8c4a-0fa27c81d128",
						  "name": "Disparo PRO",
						  "webhookId": "2fa4dafe-d9c4-4072-bb74-af75801adf3d"
						},
						{
						  "parameters": {
							"httpMethod": "POST",
							"path": "b7242245-9aa9-458a-8f7b-ad1e6f5d5ba1",
							"responseMode": "responseNode",
							"options": {}
						  },
						  "type": "n8n-nodes-base.webhook",
						  "typeVersion": 2,
						  "position": [
							80,
							140
						  ],
						  "id": "3ebcf22c-5097-42a6-ba03-77f1b1f0c953",
						  "name": "Envio Email",
						  "webhookId": "b7242245-9aa9-458a-8f7b-ad1e6f5d5ba1"
						},
						{
						  "parameters": {
							"fromEmail": "contato@zapplify.app.br",
							"toEmail": "={{ $item(\"0\").$node[\"Envio Email\"].json[\"body\"][\"to\"] }}",
							"subject": "={{ $item(\"0\").$node[\"Envio Email\"].json[\"body\"][\"subject\"] }}",
							"emailFormat": "text",
							"text": "={{ $('Envio Email').item.json.body.message }}",
							"options": {
							  "appendAttribution": false,
							  "attachments": "=data"
							}
						  },
						  "type": "n8n-nodes-base.emailSend",
						  "typeVersion": 2.1,
						  "position": [
							520,
							140
						  ],
						  "id": "7c27a6ec-962d-4537-9b55-4c4c8f2e4311",
						  "name": "Send Email",
						  "webhookId": "484f2bcf-99bf-41c7-9d7e-31c93e10323d",
						  "credentials": {
							"smtp": {
							  "id": "74v7f5FbeRWFu67e",
							  "name": "SMTP Zapplify"
							}
						  },
						  "onError": "continueErrorOutput"
						},
						{
						  "parameters": {
							"operation": "toBinary",
							"sourceProperty": "body.attachment.content",
							"options": {}
						  },
						  "type": "n8n-nodes-base.convertToFile",
						  "typeVersion": 1.1,
						  "position": [
							300,
							140
						  ],
						  "id": "b26ad2cb-2779-4e23-be3a-76ee4c7ed134",
						  "name": "Convert to File",
						  "onError": "continueRegularOutput"
						},
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "{\n  \"success\": true,\n  \"message\": \"Email enviado com sucesso!\"\n}",
							"options": {}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							740,
							40
						  ],
						  "id": "3e729e29-e937-4c81-9376-217d1a9b1407",
						  "name": "Respond to Webhook4"
						},
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "{\n  \"success\": false,\n  \"message\": \"Erro ao enviar email: descri√ß√£o do erro\"\n}",
							"options": {}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							740,
							240
						  ],
						  "id": "bd28e288-d2dc-4520-9250-5e24e363c1f5",
						  "name": "Respond to Webhook5"
						},
						{
						  "parameters": {
							"content": "## Disparador PRO",
							"height": 1360,
							"width": 3100
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							0,
							420
						  ],
						  "typeVersion": 1,
						  "id": "ea32d918-1658-490d-b9a3-1b65413a1a19",
						  "name": "Sticky Note"
						},
						{
						  "parameters": {
							"content": "## Evolution",
							"height": 400,
							"width": 1000,
							"color": 5
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							960,
							0
						  ],
						  "typeVersion": 1,
						  "id": "16afd901-6832-4159-a3c8-64e8147866a1",
						  "name": "Sticky Note1"
						},
						{
						  "parameters": {
							"content": "## Envio de E-mail",
							"height": 400,
							"width": 940,
							"color": 4
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							0,
							0
						  ],
						  "typeVersion": 1,
						  "id": "95c067e5-71a8-4bd9-8113-56cd2ce4fdc6",
						  "name": "Sticky Note2"
						},
						{
						  "parameters": {
							"respondWith": "json",
							"responseBody": "={\n  \"result\": \"error\"\n} ",
							"options": {}
						  },
						  "type": "n8n-nodes-base.respondToWebhook",
						  "typeVersion": 1.2,
						  "position": [
							1740,
							240
						  ],
						  "id": "887a2b19-ef52-4344-a6d9-e53cc42ca138",
						  "name": "Resposta Instancia1"
						},
						{
						  "parameters": {
							"conditions": {
							  "options": {
								"caseSensitive": true,
								"leftValue": "",
								"typeValidation": "strict",
								"version": 2
							  },
							  "conditions": [
								{
								  "id": "351f12ce-dc4e-4378-8891-4cc89d543074",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "string",
									"operation": "notEmpty",
									"singleValue": true
								  }
								},
								{
								  "id": "e550ac2e-d505-40fc-b2a4-2cad24454eee",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"sendEmail\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "boolean",
									"operation": "true",
									"singleValue": true
								  }
								}
							  ],
							  "combinator": "and"
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.if",
						  "typeVersion": 2.2,
						  "position": [
							1760,
							620
						  ],
						  "id": "89728d07-c709-4907-b8df-685abe6edd7d",
						  "name": "If3"
						},
						{
						  "parameters": {
							"fromEmail": "contato@zapplify.app.br",
							"toEmail": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
							"subject": "Mensagem",
							"emailFormat": "text",
							"text": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"message\"] }}",
							"options": {
							  "appendAttribution": false,
							  "attachments": "=data"
							}
						  },
						  "type": "n8n-nodes-base.emailSend",
						  "typeVersion": 2.1,
						  "position": [
							2420,
							540
						  ],
						  "id": "edb4455d-38b6-4991-9cca-89c92a541e9f",
						  "name": "Send Email1",
						  "webhookId": "3c1ad59e-cff3-4f6c-bf9a-0fa2daccfd86",
						  "credentials": {
							"smtp": {
							  "id": "74v7f5FbeRWFu67e",
							  "name": "SMTP Zapplify"
							}
						  }
						},
						{
						  "parameters": {
							"operation": "toBinary",
							"sourceProperty": "body.media.data",
							"options": {}
						  },
						  "type": "n8n-nodes-base.convertToFile",
						  "typeVersion": 1.1,
						  "position": [
							2200,
							540
						  ],
						  "id": "7aff7c7e-b347-4a32-aa4a-b1345d8f8b1e",
						  "name": "Convert to File1"
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "03cff066-0c36-4aa7-b3fc-093c0bed2a43",
								  "name": "body.media.data",
								  "value": "={{ $('Disparo PRO').item.json.body.media.data }}",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							1980,
							540
						  ],
						  "id": "cce45c1f-c606-4a69-bd9a-d81c28856802",
						  "name": "Edit Fields"
						},
						{
						  "parameters": {
							"conditions": {
							  "options": {
								"caseSensitive": true,
								"leftValue": "",
								"typeValidation": "strict",
								"version": 2
							  },
							  "conditions": [
								{
								  "id": "351f12ce-dc4e-4378-8891-4cc89d543074",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "string",
									"operation": "notEmpty",
									"singleValue": true
								  }
								},
								{
								  "id": "8fa8485a-b16d-4b3c-a26c-4dc0ea575b82",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"sendEmail\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "boolean",
									"operation": "true",
									"singleValue": true
								  }
								}
							  ],
							  "combinator": "and"
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.if",
						  "typeVersion": 2.2,
						  "position": [
							1540,
							1240
						  ],
						  "id": "2132c2b6-51e7-49c0-8317-5eb7b8e2b27d",
						  "name": "If4"
						},
						{
						  "parameters": {
							"fromEmail": "contato@zapplify.app.br",
							"toEmail": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
							"subject": "Mensagem",
							"emailFormat": "text",
							"text": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"message\"] }}",
							"options": {
							  "appendAttribution": false,
							  "attachments": "=data"
							}
						  },
						  "type": "n8n-nodes-base.emailSend",
						  "typeVersion": 2.1,
						  "position": [
							2200,
							1180
						  ],
						  "id": "6c657cfb-8b91-4a52-8fab-3e4cff209ccd",
						  "name": "Send Email2",
						  "webhookId": "03a03c3b-3b2f-41b0-9912-df86b3dcf3e5",
						  "credentials": {
							"smtp": {
							  "id": "74v7f5FbeRWFu67e",
							  "name": "SMTP Zapplify"
							}
						  }
						},
						{
						  "parameters": {
							"operation": "toBinary",
							"sourceProperty": "body.media.data",
							"options": {}
						  },
						  "type": "n8n-nodes-base.convertToFile",
						  "typeVersion": 1.1,
						  "position": [
							1980,
							1180
						  ],
						  "id": "61ca0de0-a369-45c7-8f7f-9419d8661f0d",
						  "name": "Convert to File2"
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "03cff066-0c36-4aa7-b3fc-093c0bed2a43",
								  "name": "body.media.data",
								  "value": "={{ $('Disparo PRO').item.json.body.media.data }}",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							1760,
							1180
						  ],
						  "id": "a8a67783-27c8-48e7-b500-dac9928c21f4",
						  "name": "Edit Fields1"
						},
						{
						  "parameters": {
							"conditions": {
							  "options": {
								"caseSensitive": true,
								"leftValue": "",
								"typeValidation": "strict",
								"version": 2
							  },
							  "conditions": [
								{
								  "id": "351f12ce-dc4e-4378-8891-4cc89d543074",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "string",
									"operation": "notEmpty",
									"singleValue": true
								  }
								},
								{
								  "id": "545593e1-3816-4fd2-a840-18db749983b2",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"sendEmail\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "boolean",
									"operation": "true",
									"singleValue": true
								  }
								}
							  ],
							  "combinator": "and"
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.if",
						  "typeVersion": 2.2,
						  "position": [
							1980,
							1540
						  ],
						  "id": "0e9c482c-1c92-4322-90b7-895b6c7cf045",
						  "name": "If5"
						},
						{
						  "parameters": {
							"fromEmail": "contato@zapplify.app.br",
							"toEmail": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
							"subject": "Mensagem",
							"emailFormat": "text",
							"text": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"message\"] }}",
							"options": {
							  "appendAttribution": false
							}
						  },
						  "type": "n8n-nodes-base.emailSend",
						  "typeVersion": 2.1,
						  "position": [
							2200,
							1480
						  ],
						  "id": "41ad9697-a25d-47dc-88d9-760298091e25",
						  "name": "Send Email3",
						  "webhookId": "23d9069a-a70f-4b4c-b4ad-00728d29fdfc",
						  "credentials": {
							"smtp": {
							  "id": "74v7f5FbeRWFu67e",
							  "name": "SMTP Zapplify"
							}
						  }
						},
						{
						  "parameters": {
							"conditions": {
							  "options": {
								"caseSensitive": true,
								"leftValue": "",
								"typeValidation": "strict",
								"version": 2
							  },
							  "conditions": [
								{
								  "id": "351f12ce-dc4e-4378-8891-4cc89d543074",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "string",
									"operation": "notEmpty",
									"singleValue": true
								  }
								},
								{
								  "id": "09b6ec12-e5f4-4914-9799-a375e9c4068c",
								  "leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"sendEmail\"] }}",
								  "rightValue": "",
								  "operator": {
									"type": "boolean",
									"operation": "true",
									"singleValue": true
								  }
								}
							  ],
							  "combinator": "and"
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.if",
						  "typeVersion": 2.2,
						  "position": [
							2200,
							920
						  ],
						  "id": "91b4c1c6-41ef-4f97-b01a-3bbf4da11210",
						  "name": "If6"
						},
						{
						  "parameters": {
							"fromEmail": "contato@zapplify.app.br",
							"toEmail": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"contact\"][\"email\"] }}",
							"subject": "Mensagem",
							"emailFormat": "text",
							"text": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"message\"] }}",
							"options": {
							  "appendAttribution": false
							}
						  },
						  "type": "n8n-nodes-base.emailSend",
						  "typeVersion": 2.1,
						  "position": [
							2420,
							840
						  ],
						  "id": "2e604244-fbf6-4e84-9e10-d6a7e3c19a59",
						  "name": "Send Email4",
						  "webhookId": "715421e7-c078-4c11-988c-3899a8835994",
						  "credentials": {
							"smtp": {
							  "id": "74v7f5FbeRWFu67e",
							  "name": "SMTP Zapplify"
							}
						  }
						},
						{
						  "parameters": {
							"rules": {
							  "values": [
								{
								  "conditions": {
									"options": {
									  "caseSensitive": true,
									  "leftValue": "",
									  "typeValidation": "strict",
									  "version": 2
									},
									"conditions": [
									  {
										"leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"mimetype\"] }}",
										"rightValue": "application/pdf",
										"operator": {
										  "type": "string",
										  "operation": "equals"
										},
										"id": "9b8b78ae-8c3a-42d0-b29a-ce03cf159964"
									  }
									],
									"combinator": "and"
								  },
								  "renameOutput": true,
								  "outputKey": "PDF"
								},
								{
								  "conditions": {
									"options": {
									  "caseSensitive": true,
									  "leftValue": "",
									  "typeValidation": "strict",
									  "version": 2
									},
									"conditions": [
									  {
										"id": "d9c2cc75-5d07-4271-a848-b434321a0dcf",
										"leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"mimetype\"] }}",
										"rightValue": "image",
										"operator": {
										  "type": "string",
										  "operation": "contains"
										}
									  }
									],
									"combinator": "and"
								  },
								  "renameOutput": true,
								  "outputKey": "Image"
								},
								{
								  "conditions": {
									"options": {
									  "caseSensitive": true,
									  "leftValue": "",
									  "typeValidation": "strict",
									  "version": 2
									},
									"conditions": [
									  {
										"id": "5a8736bd-d835-4aa8-bce5-853f2e466e92",
										"leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"mimetype\"] }}",
										"rightValue": "video",
										"operator": {
										  "type": "string",
										  "operation": "contains"
										}
									  }
									],
									"combinator": "and"
								  },
								  "renameOutput": true,
								  "outputKey": "Video"
								},
								{
								  "conditions": {
									"options": {
									  "caseSensitive": true,
									  "leftValue": "",
									  "typeValidation": "strict",
									  "version": 2
									},
									"conditions": [
									  {
										"id": "fb02262b-8ffe-40cc-b12c-6ed84476d094",
										"leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"mimetype\"] }}",
										"rightValue": "audio",
										"operator": {
										  "type": "string",
										  "operation": "contains"
										}
									  }
									],
									"combinator": "and"
								  },
								  "renameOutput": true,
								  "outputKey": "Audio"
								},
								{
								  "conditions": {
									"options": {
									  "caseSensitive": true,
									  "leftValue": "",
									  "typeValidation": "strict",
									  "version": 2
									},
									"conditions": [
									  {
										"id": "cf3a7d24-558c-4cac-b9fd-bb360e8eadc8",
										"leftValue": "={{ $item(\"0\").$node[\"Disparo PRO\"].json[\"body\"][\"media\"][\"mimetype\"] }}",
										"rightValue": "",
										"operator": {
										  "type": "string",
										  "operation": "notExists",
										  "singleValue": true
										}
									  }
									],
									"combinator": "and"
								  },
								  "renameOutput": true,
								  "outputKey": "Texto"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.switch",
						  "typeVersion": 3.2,
						  "position": [
							280,
							1060
						  ],
						  "id": "b9b12707-f9be-4019-8102-7dc6c049bd31",
						  "name": "Switch"
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "da946c5f-e5cd-4a4c-8ea0-0a3584940162",
								  "name": "mediatype",
								  "value": "document",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							500,
							740
						  ],
						  "id": "a16cc274-c065-4d18-b89f-8b820329936b",
						  "name": "Document"
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "da946c5f-e5cd-4a4c-8ea0-0a3584940162",
								  "name": "mediatype",
								  "value": "image",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							500,
							940
						  ],
						  "id": "cbb16068-b381-4509-b1c5-b5bbd4758ed8",
						  "name": "Image"
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "da946c5f-e5cd-4a4c-8ea0-0a3584940162",
								  "name": "mediatype",
								  "value": "video",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							500,
							1240
						  ],
						  "id": "308bf391-c22b-4f6e-b77a-ffd7cb1c2d85",
						  "name": "Video"
						},
						{
						  "parameters": {
							"assignments": {
							  "assignments": [
								{
								  "id": "da946c5f-e5cd-4a4c-8ea0-0a3584940162",
								  "name": "mediatype",
								  "value": "audio",
								  "type": "string"
								}
							  ]
							},
							"options": {}
						  },
						  "type": "n8n-nodes-base.set",
						  "typeVersion": 3.4,
						  "position": [
							500,
							1440
						  ],
						  "id": "69ce2938-50c2-4106-a48d-5442723a7ed6",
						  "name": "Audio"
						},
						{
						  "parameters": {
							"content": "## Alterar",
							"height": 280,
							"width": 160,
							"color": 3
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							480,
							60
						  ],
						  "typeVersion": 1,
						  "id": "662855b0-5f9d-4575-b4e9-0da4e17d7513",
						  "name": "Sticky Note3"
						},
						{
						  "parameters": {
							"content": "## Alterar",
							"height": 280,
							"width": 160,
							"color": 3
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							1260,
							60
						  ],
						  "typeVersion": 1,
						  "id": "19694a57-17e4-450d-9f33-9d5a59255a50",
						  "name": "Sticky Note4"
						},
						{
						  "parameters": {
							"content": "## Alterar",
							"height": 280,
							"width": 160,
							"color": 3
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							680,
							1020
						  ],
						  "typeVersion": 1,
						  "id": "a87cdaf9-b929-4fee-a9ac-41784391e993",
						  "name": "Sticky Note5"
						},
						{
						  "parameters": {
							"content": "## Alterar",
							"height": 560,
							"width": 160,
							"color": 3
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							2380,
							480
						  ],
						  "typeVersion": 1,
						  "id": "49b9c81d-0688-4ea8-99bc-4e8543ccd13b",
						  "name": "Sticky Note6"
						},
						{
						  "parameters": {
							"content": "## Alterar",
							"height": 560,
							"width": 160,
							"color": 3
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							2160,
							1100
						  ],
						  "typeVersion": 1,
						  "id": "260d2e2d-be0b-45ba-ba58-6dcffa8a3bc0",
						  "name": "Sticky Note7"
						},
						{
						  "parameters": {
							"content": "## ATEN√á√ÉO\nDeixei em vermelho os locais que voc√™ precisa alterar no workflow. Verifique se o link da instancia tem a barra no final e se configurou todos os n√≥s.",
							"width": 360,
							"color": 3
						  },
						  "type": "n8n-nodes-base.stickyNote",
						  "position": [
							0,
							-180
						  ],
						  "typeVersion": 1,
						  "id": "3a345b3f-160a-4950-80af-09a5fcc648ed",
						  "name": "Sticky Note8"
						}
					  ],
					  "pinData": {},
					  "connections": {
						"Configura√ß√µes Evolution": {
						  "main": [
							[
							  {
								"node": "If1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"AI Agent": {
						  "main": [
							[
							  {
								"node": "If",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"If": {
						  "main": [
							[
							  {
								"node": "If3",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "If6",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Envio Texto": {
						  "main": [
							[
							  {
								"node": "Respond to Webhook",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Respond to Webhook1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Envio M√≠dia": {
						  "main": [
							[
							  {
								"node": "Respond to Webhook",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Respond to Webhook1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"If1": {
						  "main": [
							[
							  {
								"node": "AI Agent",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "If2",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"If2": {
						  "main": [
							[
							  {
								"node": "If4",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "If5",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Envio Texto2": {
						  "main": [
							[
							  {
								"node": "Respond to Webhook2",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Respond to Webhook3",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Envio M√≠dia1": {
						  "main": [
							[
							  {
								"node": "Respond to Webhook2",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Respond to Webhook3",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Groq Chat Model": {
						  "ai_languageModel": [
							[
							  {
								"node": "AI Agent",
								"type": "ai_languageModel",
								"index": 0
							  }
							]
						  ]
						},
						"Configura√ß√µes Evolution1": {
						  "main": [
							[
							  {
								"node": "Verifica Instancia",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Verifica Conexao": {
						  "main": [
							[
							  {
								"node": "Configura√ß√µes Evolution1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Verifica Instancia": {
						  "main": [
							[
							  {
								"node": "Resposta Instancia",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Resposta Instancia1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Disparo PRO": {
						  "main": [
							[
							  {
								"node": "Switch",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Envio Email": {
						  "main": [
							[
							  {
								"node": "Convert to File",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Convert to File": {
						  "main": [
							[
							  {
								"node": "Send Email",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Send Email": {
						  "main": [
							[
							  {
								"node": "Respond to Webhook4",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Respond to Webhook5",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"If3": {
						  "main": [
							[
							  {
								"node": "Edit Fields",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Envio M√≠dia",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Send Email1": {
						  "main": [
							[
							  {
								"node": "Envio M√≠dia",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Convert to File1": {
						  "main": [
							[
							  {
								"node": "Send Email1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Edit Fields": {
						  "main": [
							[
							  {
								"node": "Convert to File1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"If4": {
						  "main": [
							[
							  {
								"node": "Edit Fields1",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Envio M√≠dia1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Convert to File2": {
						  "main": [
							[
							  {
								"node": "Send Email2",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Edit Fields1": {
						  "main": [
							[
							  {
								"node": "Convert to File2",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Send Email2": {
						  "main": [
							[
							  {
								"node": "Envio M√≠dia1",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"If5": {
						  "main": [
							[
							  {
								"node": "Send Email3",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Envio Texto2",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Send Email3": {
						  "main": [
							[
							  {
								"node": "Envio Texto2",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"If6": {
						  "main": [
							[
							  {
								"node": "Send Email4",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Envio Texto",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Send Email4": {
						  "main": [
							[
							  {
								"node": "Envio Texto",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Switch": {
						  "main": [
							[
							  {
								"node": "Document",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Image",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Video",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Audio",
								"type": "main",
								"index": 0
							  }
							],
							[
							  {
								"node": "Configura√ß√µes Evolution",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Document": {
						  "main": [
							[
							  {
								"node": "Configura√ß√µes Evolution",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Image": {
						  "main": [
							[
							  {
								"node": "Configura√ß√µes Evolution",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Video": {
						  "main": [
							[
							  {
								"node": "Configura√ß√µes Evolution",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						},
						"Audio": {
						  "main": [
							[
							  {
								"node": "Configura√ß√µes Evolution",
								"type": "main",
								"index": 0
							  }
							]
						  ]
						}
					  },
					  "active": false,
					  "settings": {
						"executionOrder": "v1"
					  },
					  "versionId": "08730aed-2a8a-413d-a5c1-3654fa61d10c",
					  "meta": {
						"instanceId": "dcde2d1c7084facb50886e5a617bb75f5c5201283a9dde593f54fa2281522102"
					  },
					  "id": "2b8utWGmH0OJUzo3",
					  "tags": []
					
				
                };

                // Converter para JSON
                const jsonContent = JSON.stringify(workflowContent, null, 2);

                // Criar blob e download
                const blob = new Blob([jsonContent], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = url;
                link.download = 'disparadorPRO.json';
                link.style.display = 'none';

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                URL.revokeObjectURL(url);

                console.log('‚úÖ Workflow baixado com sucesso');

                // Feedback visual
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check"></i> Baixado!';
                btn.style.background = 'var(--success-color)';

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);

            } catch (error) {
                console.error('‚ùå Erro ao baixar workflow:', error);
                alert('Erro ao baixar o workflow. Tente novamente.');
            }
        }
    </script>
</body>

</html>